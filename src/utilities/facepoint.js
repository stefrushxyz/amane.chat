import React, { useEffect } from 'react'
import { randomChoice } from './general'
 
export function transformFacepoints(facepoints, canvas, viewSettings) {
  function getFacebounds(points) {
    let xMin = Infinity, yMin = Infinity, xMax = 0, yMax = 0

    for (const [x, y] of points) {
      xMin = Math.min(x, xMin)
      yMin = Math.min(y, yMin)
      xMax = Math.max(x, xMax)
      yMax = Math.max(y, yMax)
    }
    
    return { xMin, yMin, xMax, yMax, width: xMax - xMin, height: yMax - yMin }
  }

  function moveFacepointsTopLeft(points, bounds) {
    return points.map(([x, y]) => [x - bounds.xMin, y - bounds.yMin])
  }

  function zoomFacepoints(points, scalar) {
    return points.map(([x, y]) => [ 
      x * scalar * viewSettings.zoomLevel,
      y * scalar * viewSettings.zoomLevel,
    ])
  }

  function centerFacepoints(points, bounds) {
    return points.map(([x, y]) => {
      const xOffset = (canvas.width - bounds.width) / 2
      const yOffset = (canvas.height - bounds.height) / 2
      return [x + xOffset, y + yOffset]
    })
  }

  let facebounds = getFacebounds(facepoints)

  if (!viewSettings.center) {
    return {
      transformedFacepoints: facepoints.map(([x, y]) => [x, y]),
      facebounds,
    }
  }

  let transformedFacepoints = moveFacepointsTopLeft(facepoints, facebounds)

  if (viewSettings.zoom) {
    const zoomScalar = Math.min(
      canvas.width / (facebounds.xMax - facebounds.xMin),
      canvas.height / (facebounds.yMax - facebounds.yMin),
    )
    transformedFacepoints = zoomFacepoints(transformedFacepoints, zoomScalar)
    facebounds = getFacebounds(transformedFacepoints)
  }

  transformedFacepoints = centerFacepoints(transformedFacepoints, facebounds)
  facebounds = getFacebounds(transformedFacepoints)

  return { transformedFacepoints, facebounds }
}

export function calculatePointXYs(points, facepoints, facebounds) {
  return points.map(({ facepointIdx, faceX, faceY }) => {
    if (facepoints[facepointIdx] === undefined) {
      return null
    }

    const [x, y] = facepoints[facepointIdx]

    return [
      x + (faceX * facebounds.width / 2),
      y + (faceY * facebounds.height / 2),
    ]
  }).filter((point) => point !== null)
}

export function calculateScaledPathValue(pathValue, facebounds) {
  return Math.min(facebounds.width, facebounds.height) * (pathValue / 200)
}

export function randomFace() {
  return randomChoice(FACEPOINT_CAPTURES)
}

export const FACEPOINT_CAPTURES = [
  [[300.7853775024414,285.5078430175781],[288.6172409057617,265.38079833984375],[296.4036331176758,269.2976379394531],[280.6774673461914,233.29705810546875],[286.5818862915039,256.6405334472656],[286.2527847290039,243.19708251953125],[287.9833297729492,209.13192749023438],[240.12506866455078,205.29522705078125],[286.67325592041016,187.86231994628906],[284.42589569091797,176.63516235351562],[279.8858108520508,129.1162872314453],[301.99044036865234,289.15869140625],[303.4696578979492,290.91302490234375],[304.65734100341797,290.2995910644531],[307.4857711791992,307.2015380859375],[307.63927459716797,311.1600341796875],[308.23229217529297,315.5270080566406],[309.5283737182617,320.1376953125],[312.69310760498047,325.8286437988281],[291.09032440185547,268.94775390625],[284.67125701904297,266.8043518066406],[217.62174224853516,172.6365966796875],[264.6336135864258,210.20755004882812],[256.8647689819336,211.60037231445312],[248.98082733154297,212.28125],[238.56340789794922,208.11459350585938],[270.2145004272461,208.08474731445312],[247.23877716064453,192.98365783691406],[256.2681655883789,192.5027618408203],[239.79125213623047,194.87249755859375],[235.85637664794922,197.8805389404297],[234.38195037841797,214.25308227539062],[286.1355514526367,334.43115234375],[237.1305160522461,203.75698852539062],[222.46283721923828,208.70950317382812],[227.82085418701172,209.32339477539062],[256.4370803833008,249.87765502929688],[287.56116485595703,284.9804382324219],[291.87474822998047,291.3371887207031],[276.21961212158203,285.8061828613281],[270.64579010009766,286.77099609375],[283.2101821899414,290.73431396484375],[277.54553985595703,290.33447265625],[268.6310043334961,300.5289001464844],[281.79756927490234,265.4792175292969],[279.16524505615234,256.89447021484375],[224.68721771240234,191.93600463867188],[270.85457611083984,226.772705078125],[266.0314712524414,258.1622314453125],[266.06090545654297,252.38861083984375],[235.74556732177734,247.55853271484375],[279.3693161010742,244.47491455078125],[237.26155853271484,183.86068725585938],[228.68868255615234,186.62106323242188],[218.49842071533203,159.17759704589844],[270.5945816040039,187.910888671875],[264.3931198120117,194.12448120117188],[259.9987564086914,289.9486999511719],[249.5156021118164,282.3962097167969],[272.75011444091797,262.6481628417969],[280.2083969116211,265.6558532714844],[264.8408889770508,290.4809265136719],[269.2032241821289,290.9278564453125],[224.74755096435547,181.06126403808594],[266.9878158569336,260.3839111328125],[250.8073501586914,183.73463439941406],[247.75151824951172,176.92440795898438],[237.6805191040039,139.0594940185547],[221.52579498291016,170.08279418945312],[243.03047943115234,157.2968292236328],[221.27877044677734,187.6582489013672],[219.27246856689453,180.9426727294922],[289.49256134033203,289.2604064941406],[279.92235565185547,289.1633605957031],[273.8897933959961,288.7301330566406],[275.0987319946289,263.85821533203125],[266.6503677368164,290.6806335449219],[272.0501937866211,298.04254150390625],[271.02237701416016,290.8869323730469],[275.07738494873047,262.8990478515625],[279.8193588256836,289.01336669921875],[285.9077682495117,289.8453674316406],[294.0767288208008,290.6522521972656],[299.1232376098633,325.8218994140625],[296.2634963989258,319.6471252441406],[295.5357894897461,315.0332336425781],[295.73499298095703,310.6634216308594],[296.60941314697266,307.23699951171875],[281.40930938720703,301.2317199707031],[279.69080352783203,302.49700927734375],[277.8035354614258,304.5113525390625],[276.8704605102539,306.85675048828125],[263.7592239379883,279.509521484375],[236.61483001708984,240.6478271484375],[293.5488967895508,269.2255554199219],[277.0752182006836,297.5111999511719],[274.2545700073242,297.56280517578125],[284.2916030883789,269.47900390625],[270.8264846801758,264.44439697265625],[282.2219009399414,267.7437438964844],[264.0274429321289,231.30615234375],[251.9079360961914,237.49603271484375],[265.95726776123047,255.13168334960938],[224.30774688720703,147.74620056152344],[228.81281280517578,161.79147338867188],[233.67072296142578,177.03163146972656],[276.8316879272461,310.5884094238281],[265.3578872680664,177.46873474121094],[260.0396041870117,154.75759887695312],[255.5133285522461,133.2374725341797],[242.40966033935547,211.05569458007812],[228.71300506591797,220.42080688476562],[273.16939544677734,206.10809326171875],[230.68653106689453,200.55413818359375],[274.95581817626953,221.93994140625],[269.27892303466797,257.2027587890625],[223.92523956298828,225.83908081054688],[232.40790557861328,225.98236083984375],[240.63097381591797,228.79537963867188],[254.6067886352539,226.95346069335938],[265.02974700927734,222.98129272460938],[271.71617889404297,219.0823974609375],[281.4124526977539,211.77157592773438],[224.7931900024414,242.97125244140625],[225.90637969970703,199.69625854492188],[286.6924819946289,268.82928466796875],[270.5468521118164,236.59976196289062],[226.5403823852539,204.48797607421875],[276.1647262573242,215.048095703125],[266.58719635009766,254.08877563476562],[235.48432159423828,204.18405151367188],[269.56558990478516,250.04010009765625],[241.77806854248047,260.7166748046875],[272.43738555908203,203.17501831054688],[274.10147857666016,246.66287231445312],[257.9482650756836,307.70477294921875],[265.8593215942383,315.45623779296875],[226.83759307861328,243.55050659179688],[248.08203887939453,295.6019287109375],[220.4945297241211,193.49594116210938],[288.2455825805664,342.5679016113281],[289.7977066040039,269.1255187988281],[264.88854217529297,242.28286743164062],[224.3586654663086,210.5946044921875],[248.41765594482422,207.13095092773438],[255.72183990478516,206.90020751953125],[270.43531036376953,298.56646728515625],[228.35308074951172,259.9037780761719],[304.9731979370117,354.2173156738281],[284.22920989990234,338.9443054199219],[276.14241790771484,328.6435546875],[281.7217483520508,152.31895446777344],[321.64086151123047,355.5641174316406],[262.4337387084961,205.73721313476562],[268.2160415649414,204.03494262695312],[271.3616714477539,203.44369506835938],[222.5342788696289,197.5107421875],[265.06319427490234,198.640869140625],[257.9885025024414,197.15087890625],[250.45427703857422,197.3749237060547],[243.60942840576172,199.249755859375],[239.9939193725586,201.51702880859375],[220.16950225830078,186.81846618652344],[243.5568618774414,206.4197998046875],[298.3059310913086,274.29254150390625],[269.37622833251953,275.9724426269531],[271.85205841064453,262.33905029296875],[285.08460235595703,275.2989807128906],[288.33223724365234,197.30923461914062],[269.0434799194336,320.1146240234375],[278.69837188720703,331.0848083496094],[301.3804244995117,350.186279296875],[257.82112884521484,300.9341735839844],[269.8333206176758,201.37521362304688],[277.23168182373047,227.17739868164062],[318.6438522338867,351.5671081542969],[293.08565521240234,348.157958984375],[231.9522476196289,261.8966369628906],[288.0928726196289,304.9729309082031],[286.54044342041016,307.3785705566406],[285.52588653564453,310.8251037597656],[285.3735122680664,314.9327697753906],[286.40421295166016,319.8475646972656],[272.1477279663086,289.8843994140625],[269.01570892333984,288.96612548828125],[266.49060821533203,287.59197998046875],[259.8266067504883,283.8854675292969],[234.49701690673828,265.6973876953125],[278.3700485229492,216.49362182617188],[275.6640853881836,198.20370483398438],[272.1089859008789,198.92388916015625],[274.82430267333984,288.697998046875],[241.8027114868164,284.95465087890625],[279.69319915771484,198.96066284179688],[286.53910064697266,325.8135681152344],[286.89107513427734,231.63763427734375],[280.91637420654297,223.14962768554688],[287.4681625366211,220.90576171875],[272.95812225341797,240.86846923828125],[316.19152069091797,343.6658020019531],[314.3384017944336,333.6279602050781],[299.57384490966797,333.0435791015625],[266.4415054321289,303.6422424316406],[262.22278594970703,260.8708190917969],[276.25475311279297,315.5657653808594],[245.92752838134766,260.25726318359375],[257.0663070678711,269.45001220703125],[243.55142974853516,272.68841552734375],[299.44185638427734,342.6453857421875],[269.86502838134766,244.29669189453125],[265.2188186645508,310.6821594238281],[276.3377151489258,322.6205749511719],[256.9277877807617,291.9299011230469],[234.29405975341797,274.0415344238281],[251.3928451538086,294.2587890625],[239.12885284423828,279.10693359375],[253.59252166748047,278.0934143066406],[274.13219451904297,231.77294921875],[272.02698516845703,261.72705078125],[268.4362106323242,261.4307556152344],[273.5354232788086,257.0948486328125],[268.0369644165039,192.50038146972656],[254.4190902709961,189.727294921875],[243.12906646728516,190.1328582763672],[234.85750579833984,192.15174865722656],[230.70198822021484,195.50039672851562],[232.34859466552734,206.83294677734375],[224.04161834716797,226.0235595703125],[238.24698638916016,217.4913330078125],[245.8550033569336,219.53570556640625],[256.0061721801758,218.6617431640625],[265.38394927978516,216.011962890625],[271.6832046508789,213.05645751953125],[275.5876235961914,210.58807373046875],[232.41027069091797,222.05459594726562],[269.68936920166016,262.4248352050781],[276.19075775146484,236.64776611328125],[276.46849822998047,263.77447509765625],[282.9855270385742,266.77685546875],[277.7051315307617,264.1457824707031],[272.5442886352539,264.2435302734375],[284.20743560791016,268.09246826171875],[286.8636245727539,268.3862609863281],[274.7561721801758,203.78509521484375],[278.1343307495117,206.28369140625],[279.07210540771484,208.7947998046875],[238.1926498413086,202.95626831054688],[234.0236587524414,200.61572265625],[294.8696517944336,231.63845825195312],[357.28902435302734,191.8551025390625],[302.9366226196289,265.1496276855469],[398.6390609741211,146.80740356445312],[330.1593551635742,202.81015014648438],[339.20735931396484,202.19998168945312],[348.70482635498047,200.69000244140625],[362.64073944091797,193.6522216796875],[322.7568588256836,202.07516479492188],[341.31945037841797,181.2957000732422],[331.3560104370117,183.0432891845703],[351.1118698120117,181.2620849609375],[358.22875213623047,182.96942138671875],[371.7708969116211,197.76211547851562],[350.97386932373047,329.1916198730469],[361.8012924194336,189.25904846191406],[407.66817474365234,185.1949920654297],[383.47985076904297,190.4280548095703],[345.10543060302734,239.22836303710938],[315.11620330810547,281.7522888183594],[317.1450729370117,288.3226013183594],[331.66683197021484,279.480224609375],[343.24727630615234,278.02642822265625],[329.1323776245117,285.33154296875],[338.7845687866211,282.6911926269531],[359.65364837646484,290.0576171875],[296.5092086791992,264.04974365234375],[295.59969329833984,255.06716918945312],[370.7686996459961,173.812255859375],[321.5291976928711,220.77285766601562],[324.89659881591797,251.483642578125],[325.3415756225586,245.47213745117188],[374.7140121459961,231.125732421875],[294.74987030029297,242.72027587890625],[343.5464096069336,170.35736083984375],[358.48693084716797,170.36402893066406],[382.5614547729492,135.19606018066406],[304.3956069946289,183.62753295898438],[323.37007904052734,186.63035583496094],[365.43892669677734,277.5194091796875],[418.32933807373047,265.81524658203125],[319.84835052490234,257.5725402832031],[312.2472152709961,262.0055236816406],[359.29927825927734,278.3658142089844],[354.87206268310547,279.79107666015625],[363.58406829833984,163.3330078125],[327.93224334716797,253.12213134765625],[325.4327621459961,174.19541931152344],[325.7092819213867,166.70948791503906],[334.23973846435547,124.43588256835938],[372.2373275756836,149.37844848632812],[328.27205657958984,145.28016662597656],[377.47798919677734,167.85752868652344],[387.7230758666992,158.22218322753906],[316.31832122802734,286.1026306152344],[330.1363754272461,283.3980407714844],[340.8816452026367,280.6282043457031],[318.4589157104492,259.0043640136719],[357.19686126708984,278.97991943359375],[351.7347946166992,287.9547119140625],[353.33882904052734,280.2375183105469],[310.80675506591797,259.6006774902344],[337.75960540771484,281.4671325683594],[328.2881393432617,284.520263671875],[317.35692596435547,287.7010498046875],[327.62548065185547,322.7401428222656],[324.2953414916992,316.5317687988281],[322.48949432373047,312.07049560546875],[321.0160446166992,307.7514343261719],[319.98702239990234,304.45098876953125],[340.4388961791992,293.86944580078125],[342.05028533935547,294.7503662109375],[344.62474822998047,296.41876220703125],[346.91231536865234,298.5663757324219],[347.25167083740234,269.4988708496094],[421.8652572631836,219.042236328125],[346.7116928100586,288.6068115234375],[349.15340423583984,288.0237121582031],[309.6945114135742,266.4407958984375],[327.44503021240234,257.47503662109375],[310.85897064208984,264.3314208984375],[332.20812225341797,223.03262329101562],[348.61034393310547,225.79714965820312],[329.2113571166992,247.50344848632812],[361.6835250854492,127.28254699707031],[352.9363021850586,144.55352783203125],[345.8948287963867,162.46212768554688],[351.6576461791992,302.4685974121094],[304.7596664428711,172.10655212402344],[305.59900665283203,148.2328643798828],[308.0495834350586,125.24420166015625],[357.5253219604492,197.6704864501953],[383.7562789916992,201.67974853515625],[318.1447982788086,201.02371215820312],[369.4572982788086,183.85357666015625],[313.4840621948242,217.38491821289062],[315.6581344604492,252.28738403320312],[397.3044967651367,205.0059814453125],[376.21544647216797,208.67123413085938],[363.1228256225586,214.02645874023438],[344.55916595458984,216.10784912109375],[331.07503509521484,215.12420654296875],[321.2452621459961,213.27142333984375],[297.1626968383789,209.91241455078125],[399.83296966552734,222.57769775390625],[377.99217987060547,181.03118896484375],[296.02111053466797,267.95556640625],[321.98571014404297,230.38540649414062],[416.8800277709961,179.3726043701172],[313.3655319213867,210.68704223632812],[331.83748626708984,246.03201293945312],[365.5542526245117,188.89549255371094],[316.2271041870117,244.721923828125],[422.37825775146484,241.23397827148438],[319.0280990600586,198.02218627929688],[305.0949478149414,243.15863037109375],[392.72554779052734,296.0393371582031],[396.31310272216797,305.0655517578125],[415.1467819213867,221.87759399414062],[405.2094955444336,280.8134460449219],[398.2398910522461,169.92929077148438],[354.11116790771484,337.89794921875],[297.4819564819336,268.2414245605469],[332.3684310913086,234.026611328125],[393.7507858276367,189.76791381835938],[346.15682220458984,195.97764587402344],[337.83312225341797,197.5581817626953],[354.4132614135742,288.0654602050781],[403.6402816772461,240.33523559570312],[339.78572845458984,351.98736572265625],[368.2332992553711,333.340576171875],[381.09752655029297,321.3116760253906],[330.6415023803711,197.95257568359375],[324.02779388427734,197.7328338623047],[320.31514739990234,197.9252471923828],[386.5901412963867,176.75759887695312],[326.20629119873047,191.46205139160156],[333.9440231323242,188.12738037109375],[341.71788787841797,186.83236694335938],[350.0102767944336,187.0131072998047],[355.5398178100586,188.18626403808594],[409.3329391479492,160.5320587158203],[352.41878509521484,193.9719696044922],[335.4729537963867,267.974853515625],[318.6201400756836,257.4672546386719],[313.17110443115234,272.05780029296875],[379.41573333740234,311.5140075683594],[367.30077362060547,324.6848449707031],[337.52950286865234,347.7576904296875],[408.77062225341797,287.56854248046875],[321.1901168823242,195.6835174560547],[304.6496047973633,223.93026733398438],[354.86605072021484,344.1659240722656],[416.6996383666992,241.85540771484375],[330.89180755615234,299.818115234375],[332.65013885498047,301.90997314453125],[334.66832733154297,305.09075927734375],[336.7802963256836,309.0860595703125],[341.55086517333984,313.8870544433594],[348.6015853881836,279.9424133300781],[350.9892807006836,278.4952697753906],[353.17467498779297,276.6230163574219],[358.28389739990234,272.04620361328125],[389.4825668334961,248.27667236328125],[304.9645462036133,213.3319091796875],[309.99507904052734,194.107666015625],[316.5400619506836,193.63555908203125],[346.38317108154297,279.2353515625],[397.1931381225586,268.89031982421875],[300.6184616088867,196.38710021972656],[346.4399642944336,320.3377380371094],[296.09923553466797,221.40325927734375],[313.85424041748047,236.0758056640625],[330.97396087646484,330.1794738769531],[365.93871307373047,293.6842041015625],[341.40132904052734,251.28451538085938],[357.56429290771484,307.91900634765625],[363.4093551635742,246.62619018554688],[352.68651580810547,258.1325988769531],[376.18993377685547,257.8611755371094],[334.6492233276367,339.90899658203125],[322.32714080810547,237.94522094726562],[374.1748580932617,301.20074462890625],[362.9508590698242,315.48785400390625],[371.84993743896484,279.60321044921875],[405.30477142333984,255.89971923828125],[384.57140350341797,281.1040344238281],[414.27526092529297,261.3733825683594],[364.59728240966797,265.2030334472656],[313.2105941772461,227.16860961914062],[313.09484100341797,257.7589111328125],[322.44957733154297,255.56002807617188],[305.6386947631836,253.84024047851562],[315.11339569091797,186.84095764160156],[328.6299362182617,180.70660400390625],[341.5281295776367,177.89166259765625],[353.3538131713867,177.367431640625],[362.9269027709961,179.17262268066406],[373.1673812866211,190.02061462402344],[412.18807220458984,203.23580932617188],[365.68920135498047,202.2667236328125],[355.13289642333984,206.53814697265625],[342.1812973022461,208.52203369140625],[330.47493743896484,208.45758056640625],[321.7076950073242,207.32745361328125],[315.5539779663086,205.99761962890625],[419.7761459350586,198.6650390625],[324.0603256225586,256.1443176269531],[304.0949935913086,233.38372802734375],[304.26171112060547,261.2367858886719],[301.71971893310547,265.17333984375],[306.05895233154297,261.7750244140625],[323.1800765991211,258.1924133300781],[299.3224868774414,266.7549133300781],[300.7290573120117,267.10455322265625],[315.40294647216797,199.19564819335938],[310.32811737060547,202.57485961914062],[306.7950973510742,205.495361328125],[358.99047088623047,188.9634552001953],[363.8237533569336,185.09654235839844]],
]
